<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>WebRTC Audio / Video Call â€“ Single HTML</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body {
  margin: 0;
  font-family: Arial, sans-serif;
  background: #0f172a;
  color: #fff;
  display: flex;
  flex-direction: column;
  align-items: center;
}

h2 {
  margin: 10px;
}

#videos {
  display: flex;
  gap: 10px;
  margin-top: 10px;
}

video {
  width: 160px;
  height: 220px;
  background: #000;
  border-radius: 10px;
  object-fit: cover;
}

#controls {
  margin-top: 15px;
  display: flex;
  gap: 10px;
}

button {
  padding: 10px 14px;
  border-radius: 8px;
  border: none;
  font-size: 14px;
  cursor: pointer;
}

.start { background: #22c55e; }
.call  { background: #3b82f6; }
.end   { background: #ef4444; }

textarea {
  width: 95%;
  height: 90px;
  margin-top: 10px;
  border-radius: 8px;
  padding: 8px;
  border: none;
  resize: none;
}
</style>
</head>

<body>

<h2>ğŸ¥ WebRTC Audio / Video Call</h2>

<div id="videos">
  <video id="localVideo" autoplay muted playsinline></video>
  <video id="remoteVideo" autoplay playsinline></video>
</div>

<div id="controls">
  <button class="start" onclick="startMedia()">ğŸ¤ Start Camera</button>
  <button class="call" onclick="createOffer()">ğŸ“ Call</button>
  <button class="call" onclick="createAnswer()">ğŸ“² Answer</button>
  <button class="end" onclick="endCall()">âŒ End</button>
</div>

<p>ğŸ“‹ Copy / Paste signaling data (for demo)</p>

<textarea id="offerBox" placeholder="Offer / Answer"></textarea>

<script>
let localStream;
let pc;

const localVideo = document.getElementById("localVideo");
const remoteVideo = document.getElementById("remoteVideo");
const offerBox = document.getElementById("offerBox");

const servers = {
  iceServers: [
    { urls: "stun:stun.l.google.com:19302" }
  ]
};

async function startMedia() {
  localStream = await navigator.mediaDevices.getUserMedia({
    video: true,
    audio: true
  });
  localVideo.srcObject = localStream;
  alert("Camera & Mic started");
}

function createPeer() {
  pc = new RTCPeerConnection(servers);

  localStream.getTracks().forEach(track => {
    pc.addTrack(track, localStream);
  });

  pc.ontrack = e => {
    remoteVideo.srcObject = e.streams[0];
  };

  pc.onicecandidate = e => {
    if (e.candidate) {
      offerBox.value = JSON.stringify(pc.localDescription);
    }
  };
}

async function createOffer() {
  createPeer();
  const offer = await pc.createOffer();
  await pc.setLocalDescription(offer);
  offerBox.value = JSON.stringify(offer);
}

async function createAnswer() {
  createPeer();
  const offer = JSON.parse(offerBox.value);
  await pc.setRemoteDescription(offer);
  const answer = await pc.createAnswer();
  await pc.setLocalDescription(answer);
  offerBox.value = JSON.stringify(answer);
}

async function setRemote() {
  const answer = JSON.parse(offerBox.value);
  await pc.setRemoteDescription(answer);
}

function endCall() {
  pc?.close();
  pc = null;
  remoteVideo.srcObject = null;
  alert("Call Ended");
}

offerBox.addEventListener("input", () => {
  if (pc && pc.signalingState === "have-local-offer") {
    setRemote();
  }
});
</script>

</body>
</html>
