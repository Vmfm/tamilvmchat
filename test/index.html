<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Tamil VM ‚Äì Live Dating Video</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body {
      background:#0f0f0f;
      color:#fff;
      font-family: Arial, sans-serif;
      text-align:center;
      margin:0;
      padding:15px;
    }
    h2 { color:#ff4d6d; }
    input {
      padding:10px;
      width:220px;
      border-radius:8px;
      border:none;
      font-size:16px;
    }
    button {
      padding:10px 20px;
      margin-top:10px;
      font-size:16px;
      border:none;
      border-radius:8px;
      background:#ff4d6d;
      color:#fff;
      cursor:pointer;
    }
    video {
      width:100%;
      max-width:420px;
      margin-top:15px;
      border-radius:12px;
      background:#000;
    }
    .videos {
      display:flex;
      flex-wrap:wrap;
      justify-content:center;
      gap:10px;
    }
  </style>
</head>
<body>

<h2>‚ù§Ô∏è Tamil VM Live Video</h2>

<input id="roomId" placeholder="Enter Room ID">
<br>
<button onclick="joinRoom()">Start / Join</button>

<div class="videos">
  <video id="localVideo" autoplay muted playsinline></video>
  <video id="remoteVideo" autoplay playsinline></video>
</div>

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<script>
/* üî• YOUR FIREBASE CONFIG */
const firebaseConfig = {
  apiKey: "AIzaSyB1VbLbqBxCiG_bfGoQgQyapXwHUQ-Q7BU",
  authDomain: "tamil-chat-2d54e.firebaseapp.com",
  databaseURL: "https://tamil-chat-2d54e-default-rtdb.firebaseio.com",
  projectId: "tamil-chat-2d54e",
  storageBucket: "tamil-chat-2d54e.appspot.com",
  messagingSenderId: "804705969240",
  appId: "1:804705969240:web:658df281dd8360843c162d"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.database();

let pc, localStream;

const iceServers = {
  iceServers: [
    { urls: "stun:stun.l.google.com:19302" },
    { urls: "stun:stun1.l.google.com:19302" }
  ]
};

async function joinRoom() {
  const roomId = document.getElementById("roomId").value.trim();
  if (!roomId) return alert("Enter Room ID");

  pc = new RTCPeerConnection(iceServers);

  localStream = await navigator.mediaDevices.getUserMedia({ video:true, audio:true });
  localStream.getTracks().forEach(track => pc.addTrack(track, localStream));
  document.getElementById("localVideo").srcObject = localStream;

  pc.ontrack = e => {
    document.getElementById("remoteVideo").srcObject = e.streams[0];
  };

  pc.onicecandidate = e => {
    if (e.candidate) {
      db.ref("rooms/"+roomId+"/candidates").push(JSON.stringify(e.candidate));
    }
  };

  const roomRef = db.ref("rooms/"+roomId);
  const snapshot = await roomRef.get();

  if (!snapshot.exists()) {
    // FIRST USER
    const offer = await pc.createOffer();
    await pc.setLocalDescription(offer);
    await roomRef.set({ offer: JSON.stringify(offer) });

    roomRef.child("answer").on("value", async s => {
      if (s.exists()) {
        await pc.setRemoteDescription(JSON.parse(s.val()));
      }
    });
  } else {
    // SECOND USER
    const offer = JSON.parse(snapshot.val().offer);
    await pc.setRemoteDescription(offer);

    const answer = await pc.createAnswer();
    await pc.setLocalDescription(answer);
    await roomRef.update({ answer: JSON.stringify(answer) });
  }

  roomRef.child("candidates").on("child_added", s => {
    pc.addIceCandidate(new RTCIceCandidate(JSON.parse(s.val())));
  });
}
</script>

</body>
</html>
